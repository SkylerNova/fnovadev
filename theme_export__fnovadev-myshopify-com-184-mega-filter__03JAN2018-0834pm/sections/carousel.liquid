{% schema %}
  {
    "name": "Hero Carousel",
    "class": "carousel",
	"max_blocks": 15,
    "settings": [
      {
        "type": "header",
        "content": "General"
      },
	  {
        "type": "checkbox",
        "id": "full_width",
        "label": "Full width?",
        "default": true
      },
	  {
        "type": "checkbox",
        "id": "full_height",
        "label": "Full height?",
        "default": true
      },
	  {
        "type": "text",
        "id": "img_height",
        "label": "Height (if not full)",
        "default": "45%"
      },
	  {
        "type": "select",
        "id": "fade",
        "label": "Effect",
        "options": [
          {"value": "false","label": "Slide"},
          {"value": "true","label": "Fade in\/out"}
        ],
        "default": "true"
      },
	  {
        "type": "header",
        "content": "Arrows"
      },
	  {
        "type": "checkbox",
        "id": "show_arrows",
        "label": "Show arrows?",
        "default": true
      },
      {
        "type": "color",
        "id": "arrow_color",
        "label": "Arrow color",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "arrow_hover_color",
        "label": "Arrow color on hover",
        "default": "#0089ff"
      },
      {
        "type": "header",
        "content": "Dots"
      },
      {
        "type": "checkbox",
        "id": "show_dots",
        "label": "Show dots?",
        "default": true
      },
      {
        "type": "color",
        "id": "dots_color",
        "label": "Dots color",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "dots_active_color",
        "label": "Active dot color",
        "default": "#0089ff"
      }
    ],
    "blocks": [
      {
        "type": "slide",
        "name": "Slide",
        "settings": [
		  {
            "type": "select",
            "id": "text_align",
            "label": "Text Alignment",
            "options": [
              {"value": "left", "label": "Left"},
			  {"value": "center", "label": "Center"},
			  {"value": "right", "label": "Right"}
            ],
            "default": "center"
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Background Image"
          },
          {
            "type": "image_picker",
            "id": "image_small",
            "label": "Background Image (mobile)"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link",
            "info": "Optional"
          },
          {
            "type": "text",
            "id": "video",
            "label": "Video",
            "info": "Optional"
          },
          {
            "type": "text",
            "id": "alt",
            "label": "ALT"
          },
          {
            "type": "checkbox",
            "id": "show_captions",
            "label": "Show captions?",
            "default": true
          },
		  {
            "type": "text",
            "id": "overlay_color",
            "label": "Background color (r,g,b,a)",
            "default": "0,0,0,0",
			"info": "0,0,0,0 for no background"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Title"
          },
		  {
            "type": "richtext",
            "id": "text",
            "label": "Description"
          },
		  {
            "type": "text",
            "id": "button",
            "label": "Button"
          },
		  {
            "type": "header",
            "content": "Button Position"
          },
          {
            "type": "text",
            "id": "button_top",
            "label": "Top"
          },
		  {
            "type": "text",
            "id": "button_right",
            "label": "Right"
          },
		  {
            "type": "text",
            "id": "button_bottom",
            "label": "Bottom"
          },
		  {
            "type": "text",
            "id": "button_left",
            "label": "Left"
          },
		  {
            "type": "header",
            "content": "Effects"
          },
		  {
            "type": "select",
            "id": "title_effect",
            "label": "Title Effect",
            "options": [
              {"value": "fadeIn", 		"label": "fadeIn"},
			  {"value": "fadeInDown", 	"label": "fadeInDown"},
			  {"value": "fadeInLeft", 	"label": "fadeInLeft"},
			  {"value": "fadeInRight", 	"label": "fadeInRight"},
			  {"value": "fadeInUp", 	"label": "fadeInUp"},
			  {"value": "bounceIn", 	"label": "bounceIn"},
			  {"value": "bounceInDown", "label": "bounceInDown"},
			  {"value": "bounceInLeft", "label": "bounceInLeft"},
			  {"value": "bounceInRight","label": "bounceInRight"},
			  {"value": "bounceInUp", 	"label": "bounceInUp"},
		      {"value": "flipInX", 		"label": "flipInX"},
			  {"value": "flipInY", 		"label": "flipInY"},
			  {"value": "zoomIn", 		"label": "zoomIn"},
			  {"value": "zoomInDown", 	"label": "zoomInDown"},
			  {"value": "zoomInLeft", 	"label": "zoomInLeft"},
			  {"value": "zoomInRight", 	"label": "zoomInRight"},
			  {"value": "zoomInUp", 	"label": "zoomInUp"}
            ],
            "default": "fadeInUp"
          },
		  {
            "type": "select",
            "id": "text_effect",
            "label": "Description Effect",
            "options": [
              {"value": "fadeIn", 		"label": "fadeIn"},
			  {"value": "fadeInDown", 	"label": "fadeInDown"},
			  {"value": "fadeInLeft", 	"label": "fadeInLeft"},
			  {"value": "fadeInRight", 	"label": "fadeInRight"},
			  {"value": "fadeInUp", 	"label": "fadeInUp"},
			  {"value": "bounceIn", 	"label": "bounceIn"},
			  {"value": "bounceInDown", "label": "bounceInDown"},
			  {"value": "bounceInLeft", "label": "bounceInLeft"},
			  {"value": "bounceInRight","label": "bounceInRight"},
			  {"value": "bounceInUp", 	"label": "bounceInUp"},
		      {"value": "flipInX", 		"label": "flipInX"},
			  {"value": "flipInY", 		"label": "flipInY"},
			  {"value": "zoomIn", 		"label": "zoomIn"},
			  {"value": "zoomInDown", 	"label": "zoomInDown"},
			  {"value": "zoomInLeft", 	"label": "zoomInLeft"},
			  {"value": "zoomInRight", 	"label": "zoomInRight"},
			  {"value": "zoomInUp", 	"label": "zoomInUp"}
            ],
            "default": "fadeInUp"
          },
          {
            "type": "select",
            "id": "button_effect",
            "label": "Button Effect",
            "options": [
              {"value": "fadeIn", 		"label": "fadeIn"},
			  {"value": "fadeInDown", 	"label": "fadeInDown"},
			  {"value": "fadeInLeft", 	"label": "fadeInLeft"},
			  {"value": "fadeInRight", 	"label": "fadeInRight"},
			  {"value": "fadeInUp", 	"label": "fadeInUp"},
			  {"value": "bounceIn", 	"label": "bounceIn"},
			  {"value": "bounceInDown", "label": "bounceInDown"},
			  {"value": "bounceInLeft", "label": "bounceInLeft"},
			  {"value": "bounceInRight","label": "bounceInRight"},
			  {"value": "bounceInUp", 	"label": "bounceInUp"},
		      {"value": "flipInX", 		"label": "flipInX"},
			  {"value": "flipInY", 		"label": "flipInY"},
			  {"value": "zoomIn", 		"label": "zoomIn"},
			  {"value": "zoomInDown", 	"label": "zoomInDown"},
			  {"value": "zoomInLeft", 	"label": "zoomInLeft"},
			  {"value": "zoomInRight", 	"label": "zoomInRight"},
			  {"value": "zoomInUp", 	"label": "zoomInUp"}
            ],
            "default": "fadeInUp"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Hero Carousel",
        "category": "Home",
        "blocks": [
          {
            "type": "slide"
          },
          {
            "type": "slide"
          }
        ]
      }
    ]
  }
{% endschema %}

<style>
  #shopify-section-{{ section.id }} .hero-carousel .slick-arrow {color: {{section.settings.arrow_color}};}
  .notMobile #shopify-section-{{ section.id }} .hero-carousel .slick-arrow:hover {color: {{section.settings.arrow_hover_color}};}
  #shopify-section-{{ section.id }} .hero-carousel .slick-dots{width:auto;left: 50%;transform: translateX(-50%);}
  #shopify-section-{{ section.id }} .hero-carousel .slick-dots li button {background: {{section.settings.dots_color}};}
  #shopify-section-{{ section.id }} .hero-carousel .slick-dots li.slick-active button {background: {{ section.settings.dots_active_color }}; border-color: {{ section.settings.dots_active_color }};}
  #shopify-section-{{ section.id }} .hero-carousel .item_img.normal {padding-top: {{section.settings.img_height}};}
  
  @media all and (min-width: 601px) and (max-width: 900px) {
    /*#shopify-section-{{ section.id }} .hero-carousel .item_img.normal {padding-top: 70%;}*/
  }
  @media all and (max-width: 600px) {
    #shopify-section-{{ section.id }} .hero-carousel .item_img.normal {padding-top: 70%;}
    /*#shopify-section-{{ section.id }} .hero-carousel .item_img.normal {padding-top: 120%;}*/
    /*#shopify-section-{{ section.id }} .hero-carousel .featured-img {position: static; margin: auto; width: 50% !important; height: auto; padding-top: 50%;}*/
  }
</style>

<div id="carousel" class="hero-carousel slick-pending {% unless section.settings.full_width %}container{% endunless %}">
  {% for block in section.blocks %}
      <div class="item" id="block-{{ block.id }}">
        {% if block.settings.show_captions == false and block.settings.link != blank %}
          <a onClick="trackCarousel({{ forloop.index }});" href="{{block.settings.link}}">
        {% elsif block.settings.show_captions == false and block.settings.video != blank %}
          <a onClick="trackCarousel({{ forloop.index }});" class="fancybox fancybox.iframe" href="{{block.settings.video}}?autoplay=1&loop=1&autopause=0">          
        {% endif %}
            
            {% if block.settings.image != blank %}
            {% assign img_url = block.settings.image | img_url: '2048x' %}
            {% else %}
            {% assign img_url = "placeholder-image.jpg" | asset_url %}
            {% endif %}
            
            {% if block.settings.image_small != blank %}
            {% assign img_url_small = block.settings.image_small | img_url: '640x' %}
            {% else %}
            {% assign img_url_small = img_url %}
            {% endif %}
            <div class="item_img small--hide {% if section.settings.full_height %}full-height{% else %}normal{% endif %}" style="background-image: url({{ img_url }});"></div>
            <div class="item_img hide small--show {% if section.settings.full_height %}full-height{% else %}normal{% endif %}" style="background-image: url({{ img_url_small }});"></div>
                        
            <div class="item-overlay overlay-{{forloop.index}} text-{{block.settings.text_align}}" style="background-color: rgba({{block.settings.overlay_color}});">
              <div class="table">
                <div class="table-cell">
                  {% if block.settings.show_captions %}
                  <div class="captions" style="{% if block.settings.text_align == "left" %}margin-right:auto;{% elsif block.settings.text_align == "right" %}margin-left:auto;{% else %}margin-left: auto; margin-right: auto;{% endif %}">
                    {% if block.settings.title != "" %}
                        <h1 class="title {% if forloop.first %}animated {{block.settings.title_effect}}{% else %}invisible{% endif %}" data-effect="{{block.settings.title_effect}}" >{{ block.settings.title }}</h1>
                    {% endif %}
                    {% if block.settings.text != "" %}
                        <div class="text {% if forloop.first %}animated {{block.settings.text_effect}}{% else %}invisible{% endif %}" data-effect="{{block.settings.text_effect}}">{{ block.settings.text }}</div>
                    {% endif %}
                    {% if block.settings.button != "" %}
                      <a href="{{ block.settings.link }}" onClick="trackCarousel({{ forloop.index }});">
                        <button class="btn {% if forloop.first %}animated {{block.settings.button_effect}}{% else %}invisible{% endif %}" data-effect="{{block.settings.button_effect}}">{{ block.settings.button }}</button>
                      </a>
                    {% endif %}
                  </div>
                  {% endif %}
                  {% if block.settings.featured_image != blank %}
                  <div class="featured-img {% if forloop.first %}animated {{block.settings.image_effect}}{% else %}invisible{% endif %}" data-effect="{{block.settings.image_effect}}" style="background-image: url({{ block.settings.featured_image | img_url: 'master' }}); background-position: {{block.settings.featured_image_position}}; width: {{block.settings.featured_image_width}}; right: {{block.settings.featured_image_right}}; left: {{block.settings.featured_image_left}};"></div>
                  {% endif %}
                </div>
              </div>
            </div>
        {% if block.settings.link != blank or block.settings.video != blank %}
          </a>
        {% endif %}
        <style>
          {% if block.settings.button_top != "" or block.settings.button_right != "" or block.settings.button_bottom != "" or block.settings.button_left != "" %}
          #block-{{ block.id }} .btn{
            position:absolute;
            {% if block.settings.button_top != "" %}top:{{block.settings.button_top}};{% endif %}
            {% if block.settings.button_right != "" %}right:{{block.settings.button_right}};{% endif %}
            {% if block.settings.button_bottom != "" %}bottom:{{block.settings.button_bottom}};{% endif %}
            {% if block.settings.button_left != "" %}left:{{block.settings.button_left}};{% endif %}
          }
          @media all and (max-width: 600px) {
            #block-{{ block.id }} .btn{position:static;}
          }
          {% endif %}
        </style>
      </div>
  {% endfor %}
</div>
<script>
  $(function(){
    {% if section.settings.full_height %}
      {% if headerMode == "over" %}
        $('.hero-carousel .item_img.full-height').height($(window).height());
        $(window).resize(function(){
          $('.hero-carousel .item_img.full-height').height($(window).height());
        });
      {% else %}
    	$('.hero-carousel .item_img.full-height').height($(window).height() - $('#header').height());
        $(window).resize(function(){
          $('.hero-carousel .item_img.full-height').height($(window).height() - $('#header').height());
        });
      {% endif %}
    {% endif %}

    var heroCarousel = $('#shopify-section-{{ section.id }} .hero-carousel');
    heroCarousel.slick({
      autoplay: true,
      dots: {% if section.settings.show_dots %}true{% else %}false{% endif %},
      arrows: {% if section.settings.show_arrows %}true{% else %}false{% endif %},
      fade: {{ section.settings.fade }},
      pauseOnHover: false,
      speed: 1000,
      autoplaySpeed: 5000,
      prevArrow: '<i class="lnr lnr-chevron-left animation left-arrow"></i>',
      nextArrow: '<i class="lnr lnr-chevron-right animation right-arrow"></i>'
    });
    heroCarousel.slick('slickFilter','.item');
    heroCarousel.on('beforeChange', function(event, slick, currentSlide, nextSlide){
      setTimeout(function(){
        heroCarousel.find('.slick-slide').each(function(){
          var title = $(this).find('.title');
          var text = $(this).find('.text');
          var button = $(this).find('.btn');
          var image = $(this).find('.featured-img');
          title.removeClass(title.data('effect')).removeClass('animated').addClass('invisible');
          text.removeClass(text.data('effect')).removeClass('animated').addClass('invisible');
          button.removeClass(button.data('effect')).removeClass('animated').addClass('invisible');
          image.removeClass(image.data('effect')).removeClass('animated').addClass('invisible');
        });

        var currentItem = $(slick.$slides[nextSlide]);
        currentItem.find('.title').removeClass('invisible').addClass('animated').addClass(currentItem.find('.title').data('effect'));
        currentItem.find('.text').removeClass('invisible').addClass('animated').addClass(currentItem.find('.text').data('effect'));
        currentItem.find('.btn').removeClass('invisible').addClass('animated').addClass(currentItem.find('.btn').data('effect'));
        currentItem.find('.featured-img').removeClass('invisible').addClass('animated').addClass(currentItem.find('.featured-img').data('effect'));
      }, {% if section.settings.fade == 'true' %}0{% else %}800{% endif %});
    });
    
  });
</script>


<script>
  function trackCarousel(index) {
    dataLayer.push({
     'event':'e_promotionClick',
     'ecommerce':{
       'promoClick':{
         'promotions':[{
           'name':'carousel_'+index,
           'creative':'main_banner',
           'position':'home_banner_slot_'+index
         }]
       }
     }
   }); 
  }

  var promotions = [];
  {% for block in section.blocks %}
  {% assign carousel_position = 'home_banner_slot_' | append: forloop.index %}
  {% if block.settings.alt != "" %}
  promotions.push({
   'name':'{{ block.settings.alt }}',
   'creative':'main_banner',
    'position':'{{ carousel_position }}'
  });
  {% endif %}
  {% endfor %}

  dataLayer.push({
   'event':'e_promotionImpressions',
   'ecommerce':{
     'promoView':{
       'promotions':promotions
     }
   }
 });
</script>